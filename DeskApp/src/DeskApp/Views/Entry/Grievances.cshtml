

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Demo</title>

    <style>
        .form-group .help-block {
            display: none;
        }

        .form-group.has-error .help-block {
            display: block;
        }

        .dialogdemoBasicUsage #popupContainer {
            position: relative;
        }

        .dialogdemoBasicUsage .footer {
            width: 100%;
            text-align: center;
            margin-left: 20px;
        }

            .dialogdemoBasicUsage .footer, .dialogdemoBasicUsage .footer > code {
                font-size: 0.8em;
                margin-top: 50px;
            }

        .dialogdemoBasicUsage button {
            width: 200px;
        }

        .dialogdemoBasicUsage div#status {
            color: #c60008;
        }


        /*
        Copyright 2016 Google Inc. All Rights Reserved.
        Use of this source code is governed by an MIT-style license that can be in foundin the LICENSE file at http://material.angularjs.org/license.
        */
    </style>
</head>




<body layout="column" class="relative" layout-fill role="main">
    <div ng-controller="AppCtrl" style="padding: 40px;" ng-cloak="" class="datepickerdemoBasicUsage" ng-app="MyApp">


        <md-toolbar md-scroll-shrink>
            <div class="md-toolbar-tools">Intake GRS Record</div>



        </md-toolbar>



        <md-content>
            <md-tabs md-dynamic-height md-border-bottom>
                <md-tab label="Details">
                    <md-content class="md-padding">

                        <form name="myForm" ng-cloak>

                            <div class="panel panel-info">

                                <div class="panel-heading">
                                    <h4>General Information</h4>

                                </div>

                                <div class="panel-heading" ng-show="data.training_category_id != null">
                                    <h4>* This is taken Directly from Activities, some fields cannot be updated in this module (Location, date intake, etc)</h4>

                                </div>


                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">

                                            <div class="col-md-4">
                                                <label for="Region:_">Intake Date: </label>
                                            </div>

                                            <div class="col-md-4">
                                                <div class="form-group" show-errors='{showSuccess: true}'>

                                                    <md-datepicker name="Date Intake" ng-model="dt_date_intake" ng-disabled="data.training_category_id !=null" md-placeholder="Enter date" ng-change="data.date_intake = dt_date_intake.toISOString()" ng-required="true" md-min-date="minStartDate" md-max-date="today"></md-datepicker>


                                                </div>
                                            </div>

                                            <div class="col-md-4">
                                                Status of Actions Taken

                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    <select name="Resolution" ng-model="data.grs_resolution_status_id" id="region_code" class="form-control"
                                                            ng-options="option.Id as option.Name for option in grs_resolution_status_id_options" required>
                                                        <option value="">[Select Resolution Status]</option>
                                                    </select>

                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>


                                <div class="panel-body">

                                    <div class="col-md-4">

                                        <label>GRS Form</label>
                                    </div>


                                    <div class="col-md-4">
                                        <div class="form-group" show-errors='{showSuccess: true}'>

                                            <select required name="GRS Form" ng-model="data.grs_form_id" id="region_code" class="form-control"
                                                    ng-options="option.Id as option.Name for option in grs_form_id_options">
                                                <option value="">[Select Form]</option>
                                            </select>
                                        </div>
                                    </div>



                                    <div class="col-md-4" ng-show="data.grs_resolution_status_id == 1">
                                        <label>Date Addressed</label>


                                        <div class="form-group" show-errors='{showSuccess: true}'>

                                            <md-datepicker name="Date Intake" ng-model="dt_resolution_date" md-placeholder="Enter date" ng-change="data.resolution_date = dt_resolution_date.toISOString()" ng-required="data.grs_resolution_status_id == 1" md-min-date="maxDate" md-max-date="today"></md-datepicker>
                                            <p class="help-block" ng-if="myForm.dt_resolution_date.$error.required">Date of Intake required</p>

                                        </div>

                                    </div>
                                </div>


                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-4">
                                                @*<label for="Region:_">Intake Level</label>*@
                                            </div>
                                            <div class="col-md-4">

                                            </div>

                                            <div class="col-md-4" ng-show="data.grs_resolution_status_id == 1">
                                                <label>                                Feedback</label>
                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    <select name="GRS Feedback" ng-model="data.grs_feedback_id" id="region_code" class="form-control"
                                                            ng-required="data.grs_resolution_status_id==1"
                                                            ng-options="option.Id as option.Name for option in grs_feedback_id_options">
                                                        <option value="">[Select Feedback]</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-4">
                                                <label for="Region:_">Intake Level</label>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    <select name="Intake Level" ng-model="data.grs_intake_level_id" id="region_code" class="form-control"
                                                            ng-required="true"
                                                            ng-options="option.Id as option.Name for option in grs_intake_level_id_options">
                                                        <option value="">[Select Intake Level]</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                

                                <md-radio-group ng-model="data.intake_area_level" layout="column" name="Intake Area Level">
                                    <div class="panel-body">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-4">
                                                    <label>Region</label>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group" show-errors='{showSuccess: true}'>
                                                        <select name="Region" ng-model="data.region_code" id="region_code" class="form-control"
                                                                ng-required="true"
                                                                ng-disabled="data.training_category_id !=null"
                                                                ng-options="option.Id as option.Name for option in region_code_options">
                                                            <option value="">[Select Region]</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">

                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-4">
                                                    <label>Province</label>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group" show-errors='{showSuccess: true}'>
                                                        <select name="Province" ng-model="data.prov_code" id="prov_code" class="form-control"
                                                                ng-disabled="data.region_code == null || data.training_category_id !=null  || data.intake_area_level == null || data.intake_area_level == 1"
                                                                ng-required="data.intake_area_level == 2 || data.intake_area_level == 3 || data.intake_area_level == 4"
                                                                ng-options="option.Id as option.Name for option in prov_code_options">
                                                            <option value="">[Select Province]</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <md-radio-button data-ng-value="2">Provincial Level</md-radio-button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-4">
                                                    <label>Municipality</label>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group" show-errors='{showSuccess: true}'>
                                                        <select name="Municipality" ng-model="data.city_code" id="city_code" class="form-control"
                                                                ng-required="data.intake_area_level == 3 || data.intake_area_level == 4"
                                                                ng-disabled="data.prov_code == null ||  data.training_category_id !=null || data.intake_area_level == null || data.intake_area_level == 1 || data.intake_area_level == 2"
                                                                ng-options="option.Id as option.Name for option in city_code_options">
                                                            <option value="">[Select Municipality]</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <md-radio-button data-ng-value="3">Municipal Level</md-radio-button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="col-md-4">
                                                    <label>Barangay</label>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group" show-errors='{showSuccess: true}'>
                                                        <select name="Barangay" ng-model="data.brgy_code" id="brgy_code" class="form-control"
                                                                ng-required="data.intake_area_level == 4"
                                                                ng-disabled="data.city_code == null ||  data.training_category_id !=null  || data.intake_area_level == null || data.intake_area_level == 1 || data.intake_area_level == 2 || data.intake_area_level == 3"
                                                                ng-options="option.Id as option.Name for option in brgy_code_options">
                                                            <option value="">[Select Barangay]</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <md-radio-button data-ng-value="4">Barangay Level</md-radio-button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </md-radio-group>


                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-4">
                                                <label for="Region:_">Fund Source</label>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    <select name="Fund Source" ng-model="data.fund_source_id" id="brgy_code" class="form-control"
                                                            ng-required="true"
                                                            ng-disabled="data.training_category_id !=null"
                                                            ng-options="option.Id as option.Name for option in fund_source_id_options">
                                                        <option value="">[Select Fund Source]</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-4">
                                                <label for="Region:_">Mode of Filing</label>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    <select name="Mode of Filing" ng-model="data.grs_filling_mode_id" id="brgy_code" class="form-control"
                                                            ng-required="true"
                                                            ng-disabled="data.training_category_id !=null"
                                                            ng-options="option.Id as option.Name for option in grs_filling_mode_id_options">
                                                        <option value="">[Select Filing Mode]</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="col-md-4" ng-show="data.grs_filling_mode_id ==13">
                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    <input type="text" name="Other Filing Mode" ng-model="data.grs_filling_mode_others" class="form-control" placeholder="Other Filing Mode" ng-required="data.grs_filling_mode_id ==13">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>


                            <div class="panel panel-info">

                                <div class="panel-heading">
                                    <h4>I. Complainants/Sender/Observers's Information</h4>

                                </div>

                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-4">
                                                <label for="Region:_" ng-show="data.grs_form_id != 1">Type of Sender</label>
                                                <label for="Region:_" ng-show="data.grs_form_id == 1">Type of Observer</label>
                                            </div>
                                            <div class="col-md-4">

                                                <select name="Type of Sender" required ng-model="data.is_individual" ng-options="obj.value as obj.text for obj in [{'value':true,'text':'Individual Filling'},{'value':false,'text':'Group Filling'}]" ng-selected="data.is_individual" class="form-control" ng-disabled="data.grs_form_id ==1">

                                                    <option value="">[Select Type]</option>
                                                </select>


                                                @*<input type="radio" ng-model="data.is_individual" ng-checked="true" value="true" /> Individual Filling&nbsp;
                                                    <input type="radio" ng-model="data.is_individual" ng-checked="false" value="false"/>Group Filling
                                                    <md-radio-group ng-model="data.is_individual">

                                                        <md-radio-button ng-checked="true" value="true" ng-model="data.is_individual">Individual</md-radio-button>
                                                        <md-radio-button ng-checked="false" value="false"> Group </md-radio-button>


                                                    </md-radio-group>*@
                                            </div>


                                        </div>
                                    </div>
                                </div>


                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-4">
                                                <label>
                                                    Name: <small> Check if Sender is Anonymous / Unknown</small>
                                                </label>
                                                <md-checkbox ng-model="data.is_anonymous" aria-label="Checkbox 1" ng-disabled="data.grs_form_id ==1">

                                                </md-checkbox>




                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    <input ng-disabled="data.is_anonymous == true" name="Sender Name" type="text" ng-model="data.sender_name" class="form-control" placeholder="Sender Name" ng-required="data.is_anonymous !=true" />

                                                    <small ng-show="data.is_anonymous != true"><i>Sender name is required for non-anonymous senders.</i></small>
                                                </div>
                                            </div>

                                            <div class="col-md-2">

                                                <small>IP Group (Check if IP) </small>
                                                <md-checkbox ng-model="data.is_ip" aria-label="Checkbox 1">
                                            </div>


                                            <div class="col-md-2">
                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    <select name="IP Group" ng-model="data.ip_group_id" id="prov_code" class="form-control" ng-disabled="data.is_ip != true" ng-required="data.is_ip == true"
                                                            ng-enable="data.is_ip == true"
                                                            ng-options="option.Id as option.Name for option in ip_group_id_options">
                                                        <option value="">[Select IP Group]</option>
                                                    </select>
                                                </div>
                                            </div>


                                        </div>
                                    </div>
                                </div>


                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-4">
                                                <label for="Region:_">Organization</label>
                                            </div>
                                            <div class="col-md-4">

                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    @*<md-input-container class="md-block" ng-disabled="data.is_individual == true">
                                                            <label>Organization</label>
                                                            <input name="sender_organization" ng-model="data.sender_organization" ng-required="data.is_individual == false && data.is_anonymous == false" ng-disabled="data.is_anonymous == true">
                                                        </md-input-container>*@

                                                    <input name="Organization" type="text" ng-model="data.sender_organization" class="form-control" placeholder="Organization" ng-disabled="data.grs_form_id ==1" />

                                                </div>
                                                <small ng-show="data.is_anonymous != true && data.is_individual !=true"><i>Organization name is required for Group Senders and non-anonymous .</i></small>

                                            </div>


                                        </div>
                                    </div>
                                </div>

                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-4">
                                                <label for="Region:_">Sex</label>
                                            </div>
                                            <div class="col-md-4">

                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    <select name="Sex" ng-model="data.sex_id" id="prov_code" class="form-control" required
                                                            ng-options="option.Id as option.Name for option in sex_id_options">
                                                        <option value="">[Select Sex]</option>
                                                    </select>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>



                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-4">
                                                <label for="Region:_">Designation / Position</label>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    <select name="Sender Designation" ng-model="data.grs_sender_designation_id" id="prov_code" class="form-control" required
                                                            ng-options="option.Id as option.Name for option in grs_sender_designation_id_options" ng-disabled="data.grs_form_id ==1">
                                                        <option value="">[Select Sender Designation]</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="col-md-4" ng-show="data.grs_sender_designation_id == 8 || data.grs_sender_designation_id ==9">
                                                <div class="form-group" show-errors='{showSuccess: true}'>

                                                    <input type="text" placeholder="Other Senders Designation" name="Senders Other Designation" ng-model="data.sender_designation_other" ng-required="data.grs_sender_designation_id == 8 || data.grs_sender_designation_id ==9" class="form-control" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-4">
                                                <label for="Region:_">Contact Information</label>
                                            </div>
                                            <div class="col-md-4">
                                                <input name="Cellphone" ng-model="data.cellphone" id="prov_code" class="form-control" placeholder="Cellphone / Landline" />

                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    <input name="email" type="email" ng-model="data.email" id="prov_code" class="form-control" placeholder="Email " />

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>



                            </div>

                            <div class="panel panel-info">

                                <div class="panel-heading">
                                    <h4>II. Details of the Issue / Concern</h4>

                                </div>

                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-4">
                                                <label for="Region:_">Nature of Issue / Concern:</label>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    <select name="GRS Nature" required ng-model="data.grs_nature_id" id="region_code" class="form-control"
                                                            ng-options="option.Id as option.Name for option in grs_nature_id_options">
                                                        <option value="">[Select Nature]</option>
                                                    </select>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>


                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-4">
                                                <label for="Region:_">Subject of Complaint:</label>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    <select name="Subject" required ng-model="data.grs_complaint_subject_id" id="city_code" class="form-control"
                                                            ng-options="option.Id as option.Name for option in grs_complaint_subject_id_options">
                                                        <option value="">[Select Subject]</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="col-md-4" ng-show="data.grs_complaint_subject_id == 8 || data.grs_complaint_subject_id ==9">
                                                <div class="form-group" show-errors='{showSuccess: true}'>

                                                    <input type="text" placeholder="Other Designation" name="Other Complainant Subject" ng-model="data.grs_complaint_subject_others" ng-required="data.grs_complaint_subject_id == 8 || data.grs_complaint_subject_id ==9" class="form-control" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-4">
                                                <label for="Region:_">Category of Concerns:</label>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    <select name="Category of Concerns" required ng-model="data.grs_category_id" id="prov_code" class="form-control"
                                                            ng-options="option.Id as option.Name for option in grs_category_id_options">
                                                        <option value="">[Select Category]</option>
                                                    </select>
                                                </div>
                                            </div>


                                        </div>
                                    </div>
                                </div>
                            </div>



                            <div class="panel panel-info">

                                <div class="panel-heading">
                                    <h4>Details of Concern (if PINCOS, indicate if Community and / or Operation and Management Concern):</h4>

                                </div>

                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-4">
                                                <label for="Region:_">Details / Narrative Summary:</label>
                                            </div>
                                            <div class="col-md-8">

                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    <md-input-container class="md-block">

                                                        <textarea name="Details" required ng-model="data.details" md-maxlength="2000" rows="150" md-select-on-focus=""></textarea>
                                                    </md-input-container>

                                                </div>
                                            </div>


                                        </div>
                                    </div>
                                </div>

                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-4">
                                                <label for="Region:_">Actions Taken / Resolution of the Issue: </label>
                                            </div>
                                            <div class="col-md-8">

                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    <md-input-container class="md-block">

                                                        <textarea name="Actions" required ng-model="data.actions" md-maxlength="2000" rows="150" md-select-on-focus=""></textarea>
                                                    </md-input-container>

                                                </div>
                                            </div>


                                        </div>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-4">
                                                <label for="Region:_">Intake Officer:</label>
                                            </div>
                                            <div class="col-md-8">

                                                <div class="form-group" show-errors='{showSuccess: true}'>
                                                    <input required name="Intake officer" ng-model="data.intake_officer" class="form-control" />
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>






                        </form>
                    </md-content>

                    <md-content>

                        <ul>
                            <li ng-repeat="(key, errors) in myForm.$error track by $index">
                                <strong>{{ key }}</strong> errors
                                <ul>
                                    <li ng-repeat="e in errors">{{ e.$name }} has an error: <strong>{{ key }}</strong>.</li>
                                </ul>
                            </li>
                        </ul>
                        <md-container layout="row">







                            <div flex="100" layout="row" layout-margin layout-sm="column">

                                <md-button class="md-primary md-raised" ng-click="save()" ng-disabled="!myForm.$valid">
                                    Save Record
                                </md-button>

                                <md-button class="md-warn md-raised" href="/View/Grievances">
                                    Cancel
                                </md-button>

                            </div>
                        </md-container>
                    </md-content>
                </md-tab>
                <md-tab label="Discussion" ng-disabled="!status">
                    <md-content class="md-padding">

                        <md-content>

                            <form name="discussionForm" ng-cloak>

                                <div class="panel panel-danger">

                                    <div class="panel-heading">
                                        <h4>GRS Discussions</h4>

                                    </div>

                                    <div class="panel-body">

                                        <div class="col-md-12">


                                            <ul>
                                                <li ng-repeat="i in grs_discussion">
                                                    <strong>{{ i.created_by_name }}</strong>( {{i.position}}) - Posted {{i.created_date | date:'medium' }}
                                                    <ul>
                                                        {{i.remarks}}
                                                    </ul>
                                                </li>
                                            </ul>
                                        </div>


                                        <div class="col-md-12">
                                            <md-content>
                                                <strong>Details of Action</strong>
                                                <div class="col-md-12">


                                                    <div class="form-group" show-errors='{showSuccess: true}'>
                                                        <md-input-container class="md-block">

                                                            <textarea name="discussion" required ng-model="remarks" md-maxlength="2000" rows="150" md-select-on-focus="" placeholder="Place actions here"></textarea>
                                                        </md-input-container>

                                                    </div>
                                                </div>
                                            </md-content>

                                            <md-button class="md-primary md-raised" ng-click="addRemarks()" ng-disabled="!discussionForm.$valid">
                                                Add Action
                                            </md-button>

                                        </div>



                                    </div>


                                </div>
                            </form>


                        </md-content>
                    </md-content>


                </md-tab>

                @Html.Partial("~/Views/Entry/Common/_attachment.cshtml")










            </md-tabs>


        </md-content>




















    </div>


</body>




@section Scripts
{
    <script>

        angular.module('MyApp', ['ngMaterial', 'ngMessages', 'material.svgAssetsCache'])

            .controller('AppCtrl', function ($scope, $mdDialog, $http) {


                $scope.showConfirm = function (ev) {
                    // Appending dialog to document.body to cover sidenav in docs app
                    var confirm = $mdDialog.confirm()
                          .title('Would you like to save this data?')
                          .textContent('If you opt to save this data, the record will be updated/created.')
                          .ariaLabel('Lucky day')
                          .targetEvent(ev)
                          .ok('Save')
                          .cancel('Not Yet');
                    $mdDialog.show(confirm).then(function () {
                        $scope.loading = true;
                        alert("Saving");

                    }, function () {
                        $scope.status = 'You decided to keep your debt.';
                    });
                };

                $scope.intake_level_options = [{ "Id": 1, "Name": "Option 1" }, { "Id": 2, "Name": "Option 2" }, { "Id": 2, "Name": "Option 3" }];

                $scope.data;


                $http.get('/api/offline/v1/grievances/get?id=@ViewBag.id')
          .then(function (response) {

              $scope.loading = true;
              $scope.data = response.data;
              
              $scope.dt_date_intake = response.data.date_intake == undefined ? null : new Date(response.data.date_intake);
              
              $scope.minStartDate = new Date("01/01/2014");
              $scope.today = new Date();
              $scope.maxDate = new Date($scope.dt_date_intake);                           

              
              
              $scope.data.region_code = $scope.data.region_code == 0 ? "" : $scope.data.region_code;
              $scope.data.prov_code = $scope.data.prov_code == 0 ? "" : $scope.data.prov_code;
              $scope.data.city_code = $scope.data.city_code == 0 ? "" : $scope.data.city_code;
              $scope.data.brgy_code = $scope.data.brgy_code == 0 ? "" : $scope.data.brgy_code;
              $scope.data.fund_source_id = $scope.data.fund_source_id == 0 ? "" : $scope.data.fund_source_id;

             

              $scope.data.grs_form_id = $scope.data.grs_form_id == 0 ? "" : $scope.data.grs_form_id;
              $scope.data.grs_intake_level_id = $scope.data.grs_intake_level_id == 0 ? "" : $scope.data.grs_intake_level_id;
              $scope.data.grs_filling_mode_id = $scope.data.grs_filling_mode_id == 0 ? "" : $scope.data.grs_filling_mode_id;
              $scope.data.grs_resolution_status_id = $scope.data.grs_resolution_status_id == 0 ? "" : $scope.data.grs_resolution_status_id;
              $scope.data.grs_nature_id = $scope.data.grs_nature_id == 0 ? "" : $scope.data.grs_nature_id;
              $scope.data.grs_category_id = $scope.data.grs_category_id == 0 ? "" : $scope.data.grs_category_id;
              $scope.data.grs_complaint_subject_id = $scope.data.grs_complaint_subject_id == 0 ? "" : $scope.data.grs_complaint_subject_id;
              $scope.data.sex_id = $scope.data.sex_id == 0 ? "" : $scope.data.sex_id;

              
              $scope.dt_resolution_date = response.data.resolution_date == undefined ? null : new Date(response.data.resolution_date);


              

              $scope.$watch('data.intake_area_level', function (newValue, oldValue) {
                  if ($scope.data.intake_area_level == 1) {
                      $scope.data.prov_code = null;
                      $scope.data.city_code = null;
                      $scope.data.brgy_code = null;
                  }
                  if ($scope.data.intake_area_level == 2) {
                      $scope.data.city_code = null;
                      $scope.data.brgy_code = null;
                  }
                  if ($scope.data.intake_area_level == 3) {
                      $scope.data.brgy_code = null;
                  }
                  else {
                      //do nothing
                  }
              });


              


              $scope.$watch('data.is_ip', function (newValue, oldValue) {
                  if (newValue != true) {
                      $scope.data.ip_group_id = '';
                  }
              });

              $scope.$watch('data.grs_resolution_status_id', function (newValue, oldValue) {
                  if (newValue != 1) {
                      $scope.data.final_resolution = '';
                      $scope.data.grs_feedback_id = '';
                      $scope.dt_resolution_date == new Date(newValue);
                      $scope.data.resolution_date = '';
                  }
              });

              $scope.$watch('data.grs_form_id', function (newValue, oldValue) {
                  if (newValue == 1) {
                      $scope.data.is_individual = true;
                      $scope.data.grs_sender_designation_id = 3;
                      $scope.data.sender_organization = "KALAHI CIDSS";
                      $scope.data.is_anonynous = false;
                  }
              });

              $scope.$watch('data.is_anonymous', function (newValue, oldValue) {
                  if (newValue == true) {
                      $scope.data.sender_organization = '';
                      $scope.data.sender_name = '';
                  }
              });

              $scope.check_status = function () {
                  $http.get('/api/exists/grievance_record?id=@ViewBag.id')
                      .then(function (result) {

                          if (result.data == true) {
                              $scope.status = true;
                          } else {
                              $scope.status = false;
                          }
                      });
              }

              $scope.$watch('dt_date_intake', function (newValue, oldValue) {
                  $scope.maxDate = new Date(newValue);
              });

              $scope.check_status();



              $http.get('/api/online/lib_region')
      .then(function (response) { $scope.region_code_options = response.data; });

              $http.get('/Api/lib_fund_source/')
      .then(function (response) { $scope.fund_source_id_options = response.data; });

              $http.get('/api/lib_enrollment')
      .then(function (response) { $scope.enrollment_id_options = response.data; });

              $http.get('/Api/lib_lgu_level/')
      .then(function (response) { $scope.lgu_level_id_options = response.data; });

              $http.get('/Api/lib_grs_intake_level/')
      .then(function (response) { $scope.grs_intake_level_id_options = response.data; });

              $http.get('/api/lib_grs_form/')
      .then(function (response) { $scope.grs_form_id_options = response.data; });

              $http.get('/Api/lib_grs_filling_mode/')
      .then(function (response) { $scope.grs_filling_mode_id_options = response.data; });

              $http.get('/Api/lib_grs_resolution_status/')
      .then(function (response) { $scope.grs_resolution_status_id_options = response.data; });

              $http.get('/Api/lib_grs_feedback/')
      .then(function (response) { $scope.grs_feedback_id_options = response.data; });

              $http.get('/Api/lib_grs_category/')
      .then(function (response) { $scope.grs_category_id_options = response.data; });

              $http.get('/Api/lib_grs_complaint_subject/')
      .then(function (response) { $scope.grs_complaint_subject_id_options = response.data; });

              $http.get('/Api/lib_grs_nature/')
      .then(function (response) { $scope.grs_nature_id_options = response.data; });

              $http.get('/Api/lib_ip_group/')
      .then(function (response) { $scope.ip_group_id_options = response.data; });

              $http.get('/Api/lib_sex/')
      .then(function (response) { $scope.sex_id_options = response.data; });

              $http.get('/Api/lib_grs_sender_designation/')
      .then(function (response) { $scope.grs_sender_designation_id_options = response.data; });

              $http.get('/Api/lib_grs_intake_officer/')
        .then(function (response) { $scope.grs_intake_officer_id_options = response.data; });

              

              $scope.loading = false;

              $scope.edit = function () {
                  this.editMode = !this.editMode;
              };


              $scope.cancel = function () {

                  window.location.href = '/View/Grievances';
              }


              //ATTACHMENTS

              $http.get('/api/attachment_list?id=5')
              .then(function (response) {
                  $scope.attachment_list = response.data;
              });

              $scope.attached_documents = [];
              $scope.attachment = {};
              $scope.attachment.mov_list_id = null;

              $scope.uploadAttachment = function () {

                  if ($scope.attached_documents.filter(function (e) { return e.mov_list_id == $scope.attachment.mov_list_id; }).length > 0) {
                      alert("Only single attachment is allowed for Grievance Redress System (GRS) Intake Form.");
                      $scope.attachment = {};
                  }

                  else {

                      var fileUpload = $("#files").get(0);
                      var files = fileUpload.files;
                      var data = new FormData();
                      for (var i = 0; i < files.length ; i++) {
                          data.append(files[i].name, files[i]);
                      }

                      $.ajax({
                          type: "POST",
                          url: "/Mov/UploadFilesAjax?id="
                              + '@ViewBag.id'
                              + "&mov_list_id=" + $scope.attachment.mov_list_id
                              + "&region_code=" + $scope.data.region_code
                              + "&prov_code=" + $scope.data.prov_code
                              + "&city_code=" + $scope.data.city_code
                              + "&brgy_code=" + $scope.data.brgy_code
                              + "&fund_source_id=" + $scope.data.fund_source_id
                              + "&cycle_id="
                              + "&enrollment_id=",
                          contentType: false,
                          processData: false,
                          data: data,
                          success: function (message) {
                              var base = window.location.origin;

                              message.url = base + "/MOVs/" + message.attached_document_id + ".pdf";
                              $scope.attached_documents.push(message);
                              $scope.attachment = {};
                          },
                          error: function (message) {
                              alert(JSON.stringify(message.responseText));
                          }
                      });
                  }

              } //end of uploadAttachment function


              $.post('/api/mov/get/uploaded?id=' + '@ViewBag.id')
                 .success(function (value) {
                     $scope.attached_documents = value;
                     angular.forEach($scope.attached_documents, function (item) {
                         var base = window.location.origin;
                         item.url = base + "/MOVs/" + item.attached_document_id + ".pdf";
                     })
                 });

              $scope.deleteMov = function (removeitem) {
                  var ask = confirm("Are you sure you want to Delete this?");
                  if (ask == true) {
                      $.post('/api/delete/attached_document?id=' + removeitem.attached_document_id).success(function (value) {
                          $scope.loading = false;
                          //$scope.check_button_is_disabled = false;
                          var index = $scope.attached_documents.indexOf(removeitem);
                          $scope.attached_documents.splice(index, 1);
                          alert("Attachment removed!")

                      }).error(function (data) {
                          alert(JSON.stringify(data));
                          $scope.error = "An Error has occured while Deleting! " + data.statusText;
                          $scope.loading = false;
                      });
                  }
              }
              //END ATTACHMENTS


              $scope.save = function () {
                  $scope.$broadcast('show-errors-check-validity');
                  $scope.loading = true;
                  //       alert(JSON.stringify($scope.data));

                  //'/api/v1/grievances/save'


                  $.post('/api/offline/v1/grievances/save', $scope.data).success(function (data) {
                      $scope.loading = false;

                      window.location.href = "/View/Grievances";

                  }).error(function (data) {

                      alert(JSON.stringify(data));


                      $scope.error = "An Error has occured while Saving! " + data.statusText;
                      $scope.loading = false;
                  });
              };
          });




                $http.post('/api/offline/v1/grievances/exists?id=@ViewBag.id')
          .then(function (response) {


              $scope.loading = true;

              $scope.record_exists = response.data;
          });


                $http.get('/api/offline/v1/grievances/discussion/get?id=@ViewBag.id')
          .then(function (response) {
              $scope.grs_discussion = [];



              if (response.data != null) {




                  $scope.grs_discussion = response.data;






              }


          });


                $scope.addRemarks = function () {
                    $scope.disc = {};
                    $scope.disc.created_by_name = "";
                    $scope.disc.position = "";
                    $scope.disc.grievance_record_id = '@ViewBag.id';

                    $scope.disc.created_date = new Date();
                    $scope.disc.created_by_name = "You";
                    $scope.disc.remarks = $scope.remarks;
                    // alert(JSON.stringify($scope.disc));


                    $http.post("/api/offline/v1/grievances/save_discussion", $scope.disc)
                   .then(function (response) {
                       //  alert(JSON.stringify(response));

                       $scope.grs_discussion.push($scope.disc);

                       $scope.remarks = '';

                   });





                }



                $scope.$watch('data.region_code', function (newValue, oldValue) {



                    var record = $scope;

                    if (newValue == null) {
                        record.prov_code = null;
                        record.city_code = null;
                        record.brgy_code = null;


                        record.prov_code_options = [];
                        record.city_code_options = [];
                        record.brgy_code_options = [];
                    }
                    else {

                        $http({
                            method: 'GET',
                            url: '/api/online/lib_province?id=' + newValue,

                        }).success(function (data, status, headers, config) {

                            $scope.prov_code_options = data;
                        }).error(function (data, status, headers, config) {

                            $scope.message = 'Unexpected Error';
                        });
                    }

                });

                $scope.$watch('data.prov_code', function (newValue, oldValue) {

                    var record = $scope;

                    if (newValue == null) {

                        record.brgy_code = null;
                        record.city_code = null;
                        record.city_code_options = [];
                        record.brgy_code_options = [];
                    }

                    else {
                        $http({
                            method: 'GET',
                            url: '/api/online/lib_city?id=' + newValue,

                        }).success(function (data, status, headers, config) {

                            $scope.city_code_options = data;
                        }).error(function (data, status, headers, config) {

                            $scope.message = 'Unexpected Error';
                        });
                    }

                });

                $scope.$watch('data.city_code', function (newValue, oldValue) {

                    var record = $scope;

                    if (newValue == null) {

                        record.brgy_code = null;

                        record.brgy_code_options = [];
                    }

                    else {
                        $http({
                            method: 'GET',
                            url: '/api/online/lib_brgy?id=' + newValue,

                        }).success(function (data, status, headers, config) {

                            $scope.brgy_code_options = data;
                        }).error(function (data, status, headers, config) {

                            $scope.message = 'Unexpected Error';
                        });
                    }

                });




            })

        .directive('showErrors', function ($timeout, showErrorsConfig) {
            var getShowSuccess, linkFn;
            getShowSuccess = function (options) {
                var showSuccess;
                showSuccess = showErrorsConfig.showSuccess;
                if (options && options.showSuccess != null) {
                    showSuccess = options.showSuccess;
                }
                return showSuccess;
            };
            linkFn = function (scope, el, attrs, formCtrl) {
                var blurred, inputEl, inputName, inputNgEl, options, showSuccess, toggleClasses;
                blurred = false;
                options = scope.$eval(attrs.showErrors);
                showSuccess = getShowSuccess(options);
                inputEl = el[0].querySelector('[name]');
                inputNgEl = angular.element(inputEl);
                inputName = inputNgEl.attr('name');
                if (!inputName) {
                    throw 'show-errors element has no child input elements with a \'name\' attribute';
                }
                inputNgEl.bind('blur', function () {
                    blurred = true;
                    return toggleClasses(formCtrl[inputName].$invalid);
                });
                scope.$watch(function () {
                    return formCtrl[inputName] && formCtrl[inputName].$invalid;
                }, function (invalid) {
                    if (!blurred) {
                        return;
                    }
                    return toggleClasses(invalid);
                });
                scope.$on('show-errors-check-validity', function () {
                    return toggleClasses(formCtrl[inputName].$invalid);
                });
                scope.$on('show-errors-reset', function () {
                    return $timeout(function () {
                        el.removeClass('has-error');
                        el.removeClass('has-success');
                        return blurred = false;
                    }, 0, false);
                });
                return toggleClasses = function (invalid) {
                    el.toggleClass('has-error', invalid);
                    if (showSuccess) {
                        return el.toggleClass('has-success', !invalid);
                    }
                };
            };
            return {
                restrict: 'A',
                require: '^form',
                compile: function (elem, attrs) {
                    if (!elem.hasClass('form-group')) {
                        throw 'show-errors element does not have the \'form-group\' class';
                    }
                    return linkFn;
                }
            };
        }
      )

        .provider('showErrorsConfig', function () {
            var _showSuccess;
            _showSuccess = false;
            this.showSuccess = function (showSuccess) {
                return _showSuccess = showSuccess;
            };
            this.$get = function () {
                return { showSuccess: _showSuccess };
            };
        });



        /**
        Copyright 2016 Google Inc. All Rights Reserved.
        Use of this source code is governed by an MIT-style license that can be in foundin the LICENSE file at http://material.angularjs.org/license.
        **/

    </script>
}


